

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>管理接口 &mdash; envoy 1.16.0-ab2dbf documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/envoy.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/sphinx_tabs/semantic-ui-2.4.1/segment.min.css" type="text/css" />
  <link rel="stylesheet" href="../_static/sphinx_tabs/semantic-ui-2.4.1/menu.min.css" type="text/css" />
  <link rel="stylesheet" href="../_static/sphinx_tabs/semantic-ui-2.4.1/tab.min.css" type="text/css" />
  <link rel="stylesheet" href="../_static/sphinx_tabs/tabs.css" type="text/css" />
  <link rel="stylesheet" href="../_static/copybutton.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
        <script src="../_static/clipboard.min.js"></script>
        <script src="../_static/copybutton.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="统计概览" href="stats_overview.html" />
    <link rel="prev" title="热重启 Python 封装器" href="hot_restarter.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html">
          

          
            
            <img src="../_static/envoy-logo.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                1.16.0-ab2dbf
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../about_docs.html">关于文档</a></li>
<li class="toctree-l1"><a class="reference internal" href="../intro/intro.html">介绍</a></li>
<li class="toctree-l1"><a class="reference internal" href="../start/start.html">开始</a></li>
<li class="toctree-l1"><a class="reference internal" href="../install/install.html">构建和安装</a></li>
<li class="toctree-l1"><a class="reference internal" href="../version_history/version_history.html">版本历史</a></li>
<li class="toctree-l1"><a class="reference internal" href="../configuration/configuration.html">配置参考</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="operations.html">操作和管理</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="cli.html">命令行选项</a></li>
<li class="toctree-l2"><a class="reference internal" href="hot_restarter.html">热重启 Python 封装器</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">管理接口</a></li>
<li class="toctree-l2"><a class="reference internal" href="stats_overview.html">统计概览</a></li>
<li class="toctree-l2"><a class="reference internal" href="runtime.html">运行时</a></li>
<li class="toctree-l2"><a class="reference internal" href="fs_flags.html">文件系统标志</a></li>
<li class="toctree-l2"><a class="reference internal" href="traffic_tapping.html">流量捕获</a></li>
<li class="toctree-l2"><a class="reference internal" href="certificates.html">证书管理</a></li>
<li class="toctree-l2"><a class="reference internal" href="performance.html">性能</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../extending/extending.html">针对特定用例对 Envoy 进行扩展</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/api.html">API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq/overview.html">FAQ</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">envoy</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="operations.html">操作和管理</a> &raquo;</li>
        
      <li>管理接口</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/operations/admin.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="operations-admin-interface">
<span id="id1"></span><h1>管理接口<a class="headerlink" href="#operations-admin-interface" title="Permalink to this headline">¶</a></h1>
<p>Envoy 公开了一个本地管理界面，该界面可用于查询和修改服务器的不同方面：</p>
<ul class="simple">
<li><p><a class="reference internal" href="../api-v3/config/bootstrap/v3/bootstrap.proto.html#envoy-v3-api-msg-config-bootstrap-v3-admin"><span class="std std-ref">v3 API reference</span></a></p></li>
</ul>
<div class="admonition attention" id="operations-admin-interface-security">
<p class="admonition-title">Attention</p>
<p>当前形式的管理界面不仅允许执行破坏性操作（例如，关闭服务器），而且还可能公开私有信息（例如，统计信息、集群名称、证书信息等）。
<strong>至关重要的是</strong> ，仅允许通过安全网络访问管理界面。将访问管理界面的主机 <strong>仅</strong> 连接到安全网络也很 <strong>重要</strong> （即，避免 CSRF 攻击）。
这涉及设置适当的防火墙，或者最好只允许通过本地主机访问管理监听器。可以使用以下 v2 配置来完成此操作：</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">admin</span><span class="p">:</span>
  <span class="nt">access_log_path</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/tmp/admin_access.log</span>
  <span class="nt">profile_path</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/tmp/envoy.prof</span>
  <span class="nt">address</span><span class="p">:</span>
    <span class="nt">socket_address</span><span class="p">:</span> <span class="p p-Indicator">{</span><span class="nt"> address</span><span class="p">:</span> <span class="nv">127.0.0.1</span><span class="p p-Indicator">,</span><span class="nt"> port_value</span><span class="p">:</span> <span class="nv">9901</span> <span class="p p-Indicator">}</span>
</pre></div>
</div>
<p>将来，其他安全选项将添加到管理接口。在 <a class="reference external" href="https://github.com/envoyproxy/envoy/issues/2763">此</a> issue 中跟踪了这项工作。</p>
<p>所有变更都必须作为 HTTP POST 操作发送。通过 GET 请求变更时，该请求无效，并返回 HTTP 400（无效请求）响应。</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>对带有 <em>?format=json</em> 的端点，它将转储数据作为 JSON 序列化原型。具有默认值的字段不会渲染。例如 <em>/clusters?format=json</em>，
当其值为 <a class="reference internal" href="../api-v3/config/core/v3/base.proto.html#envoy-v3-api-enum-value-config-core-v3-routingpriority-default"><span class="std std-ref">DEFAULT priority</span></a> 时，将断路器阈值优先级字段，如下所示：</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
 <span class="nt">&quot;thresholds&quot;</span><span class="p">:</span> <span class="p">[</span>
  <span class="p">{</span>
   <span class="nt">&quot;max_connections&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
   <span class="nt">&quot;max_pending_requests&quot;</span><span class="p">:</span> <span class="mi">1024</span><span class="p">,</span>
   <span class="nt">&quot;max_requests&quot;</span><span class="p">:</span> <span class="mi">1024</span><span class="p">,</span>
   <span class="nt">&quot;max_retries&quot;</span><span class="p">:</span> <span class="mi">1</span>
  <span class="p">},</span>
  <span class="p">{</span>
   <span class="nt">&quot;priority&quot;</span><span class="p">:</span> <span class="s2">&quot;HIGH&quot;</span><span class="p">,</span>
   <span class="nt">&quot;max_connections&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
   <span class="nt">&quot;max_pending_requests&quot;</span><span class="p">:</span> <span class="mi">1024</span><span class="p">,</span>
   <span class="nt">&quot;max_requests&quot;</span><span class="p">:</span> <span class="mi">1024</span><span class="p">,</span>
   <span class="nt">&quot;max_retries&quot;</span><span class="p">:</span> <span class="mi">1</span>
  <span class="p">}</span>
 <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<dl class="http get">
<dt id="get--">
<code class="sig-name descname">GET </code><code class="sig-name descname">/</code><a class="headerlink" href="#get--" title="Permalink to this definition">¶</a></dt>
<dd><p>渲染 HTML 主页，其中包含指向所有可用选项链接的表。</p>
</dd></dl>

<dl class="http get">
<dt id="get--help">
<code class="sig-name descname">GET </code><code class="sig-name descname">/help</code><a class="headerlink" href="#get--help" title="Permalink to this definition">¶</a></dt>
<dd><p>打印所有可用选项的文本表。</p>
</dd></dl>

<span class="target" id="operations-admin-interface-certs"></span><dl class="http get">
<dt id="get--certs">
<code class="sig-name descname">GET </code><code class="sig-name descname">/certs</code><a class="headerlink" href="#get--certs" title="Permalink to this definition">¶</a></dt>
<dd><p>列出所有已加载的 TLS 证书，包括文件名、序列号、主题备用名称以及 JSON 格式的到期天数，这些声明均符合 <a class="reference internal" href="../api-v3/admin/v3/certs.proto.html#envoy-v3-api-msg-admin-v3-certificates"><span class="std std-ref">证书原型定义</span></a>。</p>
</dd></dl>

<span class="target" id="operations-admin-interface-clusters"></span><dl class="http get">
<dt id="get--clusters">
<code class="sig-name descname">GET </code><code class="sig-name descname">/clusters</code><a class="headerlink" href="#get--clusters" title="Permalink to this definition">¶</a></dt>
<dd><p>列出所有已配置的 <a class="reference internal" href="../intro/arch_overview/upstream/cluster_manager.html#arch-overview-cluster-manager"><span class="std std-ref">集群管理器</span></a> 集群。该信息包括每个集群中所有发现的上游主机以及每个主机的统计信息。
这对于调试服务发现问题很有用。</p>
<dl>
<dt>集群管理器信息</dt><dd><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">version_info</span></code> 字符串 – 最后加载的 <a class="reference internal" href="../configuration/upstream/cluster_manager/cds.html#config-cluster-manager-cds"><span class="std std-ref">CDS</span></a> 更新的版本信息字符串。
如果 Envoy 没有 <a class="reference internal" href="../configuration/upstream/cluster_manager/cds.html#config-cluster-manager-cds"><span class="std std-ref">CDS</span></a> 设置，则输出将显示 <code class="docutils literal notranslate"><span class="pre">version_info::static</span></code>。</p></li>
</ul>
</dd>
<dt>集群范围信息</dt><dd><ul class="simple">
<li><p>所有优先级设置的 <a class="reference internal" href="../configuration/upstream/cluster_manager/cluster_circuit_breakers.html#config-cluster-manager-cluster-circuit-breakers"><span class="std std-ref">断路器</span></a> 设置。</p></li>
<li><p>有关安装了检测器的 <a class="reference internal" href="../intro/arch_overview/upstream/outlier.html#arch-overview-outlier-detection"><span class="std std-ref">异常检测</span></a> 的信息。目前，
会展示 <a class="reference internal" href="../api-v3/data/cluster/v3/outlier_detection_event.proto.html#envoy-v3-api-field-data-cluster-v3-outlierejectsuccessrate-cluster-average-success-rate"><span class="std std-ref">平均成功率</span></a> 和
<a class="reference internal" href="../api-v3/data/cluster/v3/outlier_detection_event.proto.html#envoy-v3-api-field-data-cluster-v3-outlierejectsuccessrate-cluster-success-rate-ejection-threshold"><span class="std std-ref">弹出阈值</span></a>。
如果最后一次 :ref/<cite>interval&lt;envoy_v3_api_field_config.cluster.v3.OutlierDetection.interval&gt;</cite> 中没有足够的数据来计算它们，那么这两个值都可能为 <code class="docutils literal notranslate"><span class="pre">-1</span></code>。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">added_via_api</span></code> 标识 – 假如集群是通过静态配置添加的，则为 <code class="docutils literal notranslate"><span class="pre">false</span></code>。如果集群是通过 <a class="reference internal" href="../configuration/upstream/cluster_manager/cds.html#config-cluster-manager-cds"><span class="std std-ref">CDS</span></a> api 添加的，则为 <code class="docutils literal notranslate"><span class="pre">true</span></code>。</p></li>
</ul>
</dd>
<dt>各主机统计</dt><dd><table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>cx_total</p></td>
<td><p>Counter</p></td>
<td><p>总连接数</p></td>
</tr>
<tr class="row-odd"><td><p>cx_active</p></td>
<td><p>Gauge</p></td>
<td><p>活跃连接数</p></td>
</tr>
<tr class="row-even"><td><p>cx_connect_fail</p></td>
<td><p>Counter</p></td>
<td><p>失败的链接总数</p></td>
</tr>
<tr class="row-odd"><td><p>rq_total</p></td>
<td><p>Counter</p></td>
<td><p>总请求数</p></td>
</tr>
<tr class="row-even"><td><p>rq_timeout</p></td>
<td><p>Counter</p></td>
<td><p>超时请求数</p></td>
</tr>
<tr class="row-odd"><td><p>rq_success</p></td>
<td><p>Counter</p></td>
<td><p>非 5xx 响应请求数</p></td>
</tr>
<tr class="row-even"><td><p>rq_error</p></td>
<td><p>Counter</p></td>
<td><p>5xx 响应请求数</p></td>
</tr>
<tr class="row-odd"><td><p>rq_active</p></td>
<td><p>Gauge</p></td>
<td><p>活跃请求总数</p></td>
</tr>
<tr class="row-even"><td><p>healthy</p></td>
<td><p>String</p></td>
<td><p>主机的健康状态。见下文</p></td>
</tr>
<tr class="row-odd"><td><p>weight</p></td>
<td><p>Integer</p></td>
<td><p>负载均衡权重（1-100）</p></td>
</tr>
<tr class="row-even"><td><p>zone</p></td>
<td><p>String</p></td>
<td><p>服务域</p></td>
</tr>
<tr class="row-odd"><td><p>canary</p></td>
<td><p>Boolean</p></td>
<td><p>主机是否是金丝雀发布</p></td>
</tr>
<tr class="row-even"><td><p>success_rate</p></td>
<td><p>Double</p></td>
<td><p>“请求成功率（0-100），如果在 <a class="reference internal" href="../api-v3/config/cluster/v3/outlier_detection.proto.html#envoy-v3-api-field-config-cluster-v3-outlierdetection-interval"><span class="std std-ref">时间间隔</span></a> 内</p></td>
</tr>
<tr class="row-odd"><td><p>没有足够的 <a class="reference internal" href="../api-v3/config/cluster/v3/outlier_detection.proto.html#envoy-v3-api-field-config-cluster-v3-outlierdetection-success-rate-request-volume"><span class="std std-ref">请求量</span></a> 用于计算，则为 -1。”</p></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
</dd>
<dt>主机健康状态</dt><dd><p>主机由于一个或多个不同的失败健康状态而处于是健康或者不健康状态。如果主机健康，则 <code class="docutils literal notranslate"><span class="pre">healthy</span></code> 属于将等同于 <em>健康</em>。</p>
<p>如果主机是不健康的，则 <code class="docutils literal notranslate"><span class="pre">healthy</span></code> 输出由一个或者多个如下字符串组成：</p>
<p><em>/failed_active_hc</em>: 主机无法通过 <a class="reference internal" href="../configuration/upstream/cluster_manager/cluster_hc.html#config-cluster-manager-cluster-hc"><span class="std std-ref">活动健康检查</span></a>。</p>
<p><em>/failed_eds_health</em>: 主机被 EDS 标记为不健康。</p>
<p><em>/failed_outlier_check</em>: 主机未完成异常值检测检查。</p>
</dd>
</dl>
</dd></dl>

<dl class="http get">
<dt id="get--clusters?format=json">
<code class="sig-name descname">GET </code><code class="sig-name descname">/clusters?format=json</code><a class="headerlink" href="#get--clusters?format=json" title="Permalink to this definition">¶</a></dt>
<dd><p>将 <em>/clusters</em> 以 JSON 序列化原型转储输出。见 <a class="reference internal" href="../api-v3/admin/v3/clusters.proto.html#envoy-v3-api-msg-admin-v3-clusters"><span class="std std-ref">定义</span></a> 了解更多信息。</p>
</dd></dl>

<span class="target" id="operations-admin-interface-config-dump"></span><dl class="http get">
<dt id="get--config_dump">
<code class="sig-name descname">GET </code><code class="sig-name descname">/config_dump</code><a class="headerlink" href="#get--config_dump" title="Permalink to this definition">¶</a></dt>
<dd><p>将当前从 Envoy 组件中加载的配置转储为 JSON 序列化的原型消息。有关更多信息，
见 <a class="reference internal" href="../api-v3/admin/v3/config_dump.proto.html#envoy-v3-api-msg-admin-v3-configdump"><span class="std std-ref">响应定义</span></a>。</p>
</dd></dl>

<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>配置可以包括 <a class="reference internal" href="../api-v3/extensions/transport_sockets/tls/v3/common.proto.html#envoy-v3-api-msg-extensions-transport-sockets-tls-v3-tlscertificate"><span class="std std-ref">TLS 证书</span></a>。
转储配置前，Envoy 将尝试编辑找到的任何证书的 <code class="docutils literal notranslate"><span class="pre">private_key</span></code> 和 <code class="docutils literal notranslate"><span class="pre">password</span></code> 字段。这取决于配置是否为强类型 protobuf 消息。
如果 Envoy 配置使用已弃用的 <code class="docutils literal notranslate"><span class="pre">config</span></code> 字段（类型 <code class="docutils literal notranslate"><span class="pre">google.protobuf.Struct</span></code>），请更新为建议的 <code class="docutils literal notranslate"><span class="pre">typed_config</span></code> 字段（类型 <code class="docutils literal notranslate"><span class="pre">google.protobuf.Any</span></code>）以确保正确编辑敏感数据。</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>基础原型被标记为 v2alpha，因此不能保证其内容（包括 JSON 表示形式）是稳定的。</p>
</div>
<span class="target" id="operations-admin-interface-config-dump-include-eds"></span><dl class="http get">
<dt id="get--config_dump?include_eds">
<code class="sig-name descname">GET </code><code class="sig-name descname">/config_dump?include_eds</code><a class="headerlink" href="#get--config_dump?include_eds" title="Permalink to this definition">¶</a></dt>
<dd><p>转储当前加载的配置（包括 EDS）。有关更多信息，见 <a class="reference internal" href="../api-v3/admin/v3/config_dump.proto.html#envoy-v3-api-msg-admin-v3-endpointsconfigdump"><span class="std std-ref">响应定义</span></a>。</p>
</dd></dl>

<span class="target" id="operations-admin-interface-config-dump-by-mask"></span><dl class="http get">
<dt id="get--config_dump?mask=">
<code class="sig-name descname">GET </code><code class="sig-name descname">/config_dump?mask={}</code><a class="headerlink" href="#get--config_dump?mask=" title="Permalink to this definition">¶</a></dt>
<dd><p>指定要返回的字段的子集。掩码被解析为 <code class="docutils literal notranslate"><span class="pre">ProtobufWkt::FieldMask</span></code> 并应用于每个顶级转储，例如
<a class="reference internal" href="../api-v3/admin/v3/config_dump.proto.html#envoy-v3-api-msg-admin-v3-bootstrapconfigdump"><span class="std std-ref">BootstrapConfigDump</span></a> 和
<a class="reference internal" href="../api-v3/admin/v3/config_dump.proto.html#envoy-v3-api-msg-admin-v3-clustersconfigdump"><span class="std std-ref">ClustersConfigDump</span></a>。如果同时指定了资源和掩码查询参数，
则此行为将更改。详情请见下文。</p>
</dd></dl>

<span class="target" id="operations-admin-interface-config-dump-by-resource"></span><dl class="http get">
<dt id="get--config_dump?resource=">
<code class="sig-name descname">GET </code><code class="sig-name descname">/config_dump?resource={}</code><a class="headerlink" href="#get--config_dump?resource=" title="Permalink to this definition">¶</a></dt>
<dd><p>仅转储与指定资源匹配的已加载的配置。资源必须是顶级配置转储之一中的重复字段，例如
<a class="reference internal" href="../api-v3/admin/v3/config_dump.proto.html#envoy-v3-api-msg-admin-v3-listenersconfigdump"><span class="std std-ref">ListenersConfigDump</span></a> 中的
<a class="reference internal" href="../api-v3/admin/v3/config_dump.proto.html#envoy-v3-api-field-admin-v3-listenersconfigdump-static-listeners"><span class="std std-ref">static_listeners</span></a>，
或者 <a class="reference internal" href="../api-v3/admin/v3/config_dump.proto.html#envoy-v3-api-msg-admin-v3-clustersconfigdump"><span class="std std-ref">ClustersConfigDump</span></a> 中的
<a class="reference internal" href="../api-v3/admin/v3/config_dump.proto.html#envoy-v3-api-field-admin-v3-clustersconfigdump-dynamic-active-clusters"><span class="std std-ref">dynamic_active_clusters</span></a>。
如果需要非重复字段，请使用上面的掩码查询参数。如果只需要重复资源的字段的子集，请按照以下两个说明使用。</p>
</dd></dl>

<span class="target" id="operations-admin-interface-config-dump-by-resource-and-mask"></span><dl class="http get">
<dt id="get--config_dump?resource=&amp;mask=">
<code class="sig-name descname">GET </code><code class="sig-name descname">/config_dump?resource={}&amp;mask={}</code><a class="headerlink" href="#get--config_dump?resource=&mask=" title="Permalink to this definition">¶</a></dt>
<dd><p>当同时指定资源和掩码查询参数，会将掩码应用与所需的重复字段中的每个元素，以便仅返回字段的自己。掩码被解析为 <code class="docutils literal notranslate"><span class="pre">ProtobufWkt::FieldMask</span></code>。</p>
<p>例如，使用 <code class="docutils literal notranslate"><span class="pre">/config_dump?resource=dynamic_active_clusters&amp;mask=cluster.name</span></code> 获取所有活跃的动态集群的名字</p>
</dd></dl>

<dl class="http get">
<dt id="get--contention">
<code class="sig-name descname">GET </code><code class="sig-name descname">/contention</code><a class="headerlink" href="#get--contention" title="Permalink to this definition">¶</a></dt>
<dd><p>假如启用了互斥跟踪，则以 JSON 格式转储当前 Envoy 互斥争用统计信息（<a class="reference internal" href="../api-v3/admin/v3/mutex_stats.proto.html#envoy-v3-api-msg-admin-v3-mutexstats"><span class="std std-ref">MutexStats</span></a>）。
见 <a class="reference internal" href="cli.html#cmdoption-enable-mutex-tracing"><code class="xref std std-option docutils literal notranslate"><span class="pre">--enable-mutex-tracing</span></code></a>。</p>
</dd></dl>

<dl class="http post">
<dt id="post--cpuprofiler">
<code class="sig-name descname">POST </code><code class="sig-name descname">/cpuprofiler</code><a class="headerlink" href="#post--cpuprofiler" title="Permalink to this definition">¶</a></dt>
<dd><p>启用或禁用 CPU 事件探查器。需要使用 gperftools 进行编译。可以通过 admin.profile_path 配置输出文件。</p>
</dd></dl>

<dl class="http post">
<dt id="post--heapprofiler">
<code class="sig-name descname">POST </code><code class="sig-name descname">/heapprofiler</code><a class="headerlink" href="#post--heapprofiler" title="Permalink to this definition">¶</a></dt>
<dd><p>启用或禁用堆分析器。需要使用 gperftools 进行编译。可以通过 admin.profile_path 配置输出文件。</p>
</dd></dl>

<span class="target" id="operations-admin-interface-healthcheck-fail"></span><dl class="http post">
<dt id="post--healthcheck-fail">
<code class="sig-name descname">POST </code><code class="sig-name descname">/healthcheck/fail</code><a class="headerlink" href="#post--healthcheck-fail" title="Permalink to this definition">¶</a></dt>
<dd><p>入站健康检查失败。这需要使用 HTTP <a class="reference internal" href="../configuration/http/http_filters/health_check_filter.html#config-http-filters-health-check"><span class="std std-ref">健康检查过滤器</span></a>。
这对于在关闭服务器或完全重新启动之前排空服务器很有用。无论过滤器的配置方式如何（通过等），调用此命令通常都会使健康检查请求失败。</p>
</dd></dl>

<span class="target" id="operations-admin-interface-healthcheck-ok"></span><dl class="http post">
<dt id="post--healthcheck-ok">
<code class="sig-name descname">POST </code><code class="sig-name descname">/healthcheck/ok</code><a class="headerlink" href="#post--healthcheck-ok" title="Permalink to this definition">¶</a></dt>
<dd><p>消除 <a class="reference internal" href="#post--healthcheck-fail" title="POST /healthcheck/fail"><code class="xref http http-post docutils literal notranslate"><span class="pre">POST</span> <span class="pre">/healthcheck/fail</span></code></a> 的影响。这需要使用 HTTP <a class="reference internal" href="../configuration/http/http_filters/health_check_filter.html#config-http-filters-health-check"><span class="std std-ref">健康检查过滤器</span></a>。</p>
</dd></dl>

<dl class="http get">
<dt id="get--hot_restart_version">
<code class="sig-name descname">GET </code><code class="sig-name descname">/hot_restart_version</code><a class="headerlink" href="#get--hot_restart_version" title="Permalink to this definition">¶</a></dt>
<dd><p>See <a class="reference internal" href="cli.html#cmdoption-hot-restart-version"><code class="xref std std-option docutils literal notranslate"><span class="pre">--hot-restart-version</span></code></a>.</p>
</dd></dl>

<span class="target" id="operations-admin-interface-init-dump"></span><dl class="http get">
<dt id="get--init_dump">
<code class="sig-name descname">GET </code><code class="sig-name descname">/init_dump</code><a class="headerlink" href="#get--init_dump" title="Permalink to this definition">¶</a></dt>
<dd><p>将各种 Envoy 组件未就绪目标的当前信息转储为 JSON 序列化的原始消息。
有关更多信息，见 <a class="reference internal" href="../api-v3/admin/v3/init_dump.proto.html#envoy-v3-api-msg-admin-v3-unreadytargetsdumps"><span class="std std-ref">响应定义</span></a>。</p>
</dd></dl>

<span class="target" id="operations-admin-interface-init-dump-by-mask"></span><dl class="http get">
<dt id="get--init_dump?mask=">
<code class="sig-name descname">GET </code><code class="sig-name descname">/init_dump?mask={}</code><a class="headerlink" href="#get--init_dump?mask=" title="Permalink to this definition">¶</a></dt>
<dd><p>指定掩码查询参数时，掩码值是转储未就绪目标的所需组件。掩码被解析为 <code class="docutils literal notranslate"><span class="pre">ProtobufWkt::FieldMask</span></code>。</p>
<p>例如，通过 <code class="docutils literal notranslate"><span class="pre">/init_dump?mask=listener</span></code> 获取为所有监听器中未就绪的目标。</p>
</dd></dl>

<span class="target" id="operations-admin-interface-listeners"></span><dl class="http get">
<dt id="get--listeners">
<code class="sig-name descname">GET </code><code class="sig-name descname">/listeners</code><a class="headerlink" href="#get--listeners" title="Permalink to this definition">¶</a></dt>
<dd><p>列出所有配置的 <a class="reference internal" href="../intro/arch_overview/listeners/listeners.html#arch-overview-listeners"><span class="std std-ref">监听器</span></a>。此信息包括监听器的名称以及正在监听的地址。
如果将监听器配置为监听端口 0，则输出将包含实际的操作系统分配的端口。</p>
</dd></dl>

<dl class="http get">
<dt id="get--listeners?format=json">
<code class="sig-name descname">GET </code><code class="sig-name descname">/listeners?format=json</code><a class="headerlink" href="#get--listeners?format=json" title="Permalink to this definition">¶</a></dt>
<dd><p>将 <em>/listeners</em> 输出转储到 JSON 序列化的原型中。详细信息见 <a class="reference internal" href="../api-v3/admin/v3/listeners.proto.html#envoy-v3-api-msg-admin-v3-listeners"><span class="std std-ref">定义</span></a>。</p>
</dd></dl>

<span class="target" id="operations-admin-interface-logging"></span><dl class="http post">
<dt id="post--logging">
<code class="sig-name descname">POST </code><code class="sig-name descname">/logging</code><a class="headerlink" href="#post--logging" title="Permalink to this definition">¶</a></dt>
<dd><p>在特定的记录器或者所有记录器上启用/禁用不同的日志记录级别。</p>
<ul class="simple">
<li><p>要更改所有记录器的日志记录级别，将查询参数设置为 level=&lt;期望级别&gt;。</p></li>
<li><p>要修改特定记录器的级别，将查询参数设置为 &lt;logger_name&gt;=&lt;期望级别&gt;。</p></li>
<li><p>要列出所有的记录器，发送 POST 请求到 /logging 断点，而不带查询参数。</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>通常仅在开发期间使用。设置为 <cite>–enable-fine-grain-logging</cite> 后，
记录器由其所属文件的路径表示（具体来说，由 <cite>__FILE__</cite> 确定的路径），
因此记录器列表将显示一个文件路径列表，并且特定路径应用作 &lt;logger_name &gt; 来更改日志级别。</p>
</div>
</dd></dl>

<dl class="http get">
<dt id="get--memory">
<code class="sig-name descname">GET </code><code class="sig-name descname">/memory</code><a class="headerlink" href="#get--memory" title="Permalink to this definition">¶</a></dt>
<dd><p>打印当前的内存分配/堆使用情况。代替打印所有 <cite>/stats</cite> 和过滤以获取与内存相关的统计信息很有用。</p>
</dd></dl>

<dl class="http post">
<dt id="post--quitquitquit">
<code class="sig-name descname">POST </code><code class="sig-name descname">/quitquitquit</code><a class="headerlink" href="#post--quitquitquit" title="Permalink to this definition">¶</a></dt>
<dd><p>赶紧利落地退出服务器。</p>
</dd></dl>

<dl class="http post">
<dt id="post--reset_counters">
<code class="sig-name descname">POST </code><code class="sig-name descname">/reset_counters</code><a class="headerlink" href="#post--reset_counters" title="Permalink to this definition">¶</a></dt>
<dd><p>重置所有计数器为零。在调试过程中，与 <a class="reference internal" href="#get--stats" title="GET /stats"><code class="xref http http-get docutils literal notranslate"><span class="pre">GET</span> <span class="pre">/stats</span></code></a> 结合使用很有用。 注意这不会删除任何发送到 statsd 的数据。
它只会影响本地 <a class="reference internal" href="#get--stats" title="GET /stats"><code class="xref http http-get docutils literal notranslate"><span class="pre">GET</span> <span class="pre">/stats</span></code></a> 指令的输出。</p>
</dd></dl>

<span class="target" id="operations-admin-interface-drain"></span><dl class="http post">
<dt id="post--drain_listeners">
<code class="sig-name descname">POST </code><code class="sig-name descname">/drain_listeners</code><a class="headerlink" href="#post--drain_listeners" title="Permalink to this definition">¶</a></dt>
<dd><p><a class="reference internal" href="../intro/arch_overview/operations/draining.html#arch-overview-draining"><span class="std std-ref">排空</span></a> 所有监听器</p>
<dl class="http post">
<dt id="post--drain_listeners?inboundonly">
<code class="sig-name descname">POST </code><code class="sig-name descname">/drain_listeners?inboundonly</code><a class="headerlink" href="#post--drain_listeners?inboundonly" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p><a class="reference internal" href="../intro/arch_overview/operations/draining.html#arch-overview-draining"><span class="std std-ref">排空</span></a> 所有入站监听器。<a class="reference internal" href="../api-v3/config/listener/v3/listener.proto.html#envoy-v3-api-msg-config-listener-v3-listener"><span class="std std-ref">监听器</span></a>
中的 <cite>traffic_direction</cite> 字段用来判断监听器是入站的还是出站的。</p>
<dl class="http post">
<dt id="post--drain_listeners?graceful">
<code class="sig-name descname">POST </code><code class="sig-name descname">/drain_listeners?graceful</code><a class="headerlink" href="#post--drain_listeners?graceful" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>排空监听器时，在关闭监听器前进入一个优雅的排空期。这种行为和持续时间可通过服务器选项或者 CLI（<a class="reference internal" href="cli.html#cmdoption-drain-time-s"><code class="xref std std-option docutils literal notranslate"><span class="pre">--drain-time-s</span></code></a> and <a class="reference internal" href="cli.html#cmdoption-drain-strategy"><code class="xref std std-option docutils literal notranslate"><span class="pre">--drain-strategy</span></code></a>）来配置。</p>
</dd></dl>

<div class="admonition attention">
<p class="admonition-title">Attention</p>
<p>此操作直接停止工作程序上的匹配监听器。一旦停止了给定流量方向上的监听器，就不允许在该方向上添加和修改监听器。</p>
</div>
<dl class="http get">
<dt id="get--server_info">
<code class="sig-name descname">GET </code><code class="sig-name descname">/server_info</code><a class="headerlink" href="#get--server_info" title="Permalink to this definition">¶</a></dt>
<dd><p>输出包含有关正在运行的服务器信息的 JSON 消息。</p>
<p>示例输出如下所示：</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;version&quot;</span><span class="p">:</span> <span class="s2">&quot;b050513e840aa939a01f89b07c162f00ab3150eb/1.9.0-dev/Modified/DEBUG&quot;</span><span class="p">,</span>
  <span class="nt">&quot;state&quot;</span><span class="p">:</span> <span class="s2">&quot;LIVE&quot;</span><span class="p">,</span>
  <span class="nt">&quot;command_line_options&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;base_id&quot;</span><span class="p">:</span> <span class="s2">&quot;0&quot;</span><span class="p">,</span>
    <span class="nt">&quot;concurrency&quot;</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span>
    <span class="nt">&quot;config_path&quot;</span><span class="p">:</span> <span class="s2">&quot;config.yaml&quot;</span><span class="p">,</span>
    <span class="nt">&quot;config_yaml&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="nt">&quot;allow_unknown_static_fields&quot;</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="nt">&quot;admin_address_path&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="nt">&quot;local_address_ip_version&quot;</span><span class="p">:</span> <span class="s2">&quot;v4&quot;</span><span class="p">,</span>
    <span class="nt">&quot;log_level&quot;</span><span class="p">:</span> <span class="s2">&quot;info&quot;</span><span class="p">,</span>
    <span class="nt">&quot;component_log_level&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="nt">&quot;log_format&quot;</span><span class="p">:</span> <span class="s2">&quot;[%Y-%m-%d %T.%e][%t][%l][%n] %v&quot;</span><span class="p">,</span>
    <span class="nt">&quot;log_path&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="nt">&quot;hot_restart_version&quot;</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="nt">&quot;service_cluster&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="nt">&quot;service_node&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="nt">&quot;service_zone&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="nt">&quot;mode&quot;</span><span class="p">:</span> <span class="s2">&quot;Serve&quot;</span><span class="p">,</span>
    <span class="nt">&quot;disable_hot_restart&quot;</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="nt">&quot;enable_mutex_tracing&quot;</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="nt">&quot;restart_epoch&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="nt">&quot;file_flush_interval&quot;</span><span class="p">:</span> <span class="s2">&quot;10s&quot;</span><span class="p">,</span>
    <span class="nt">&quot;drain_time&quot;</span><span class="p">:</span> <span class="s2">&quot;600s&quot;</span><span class="p">,</span>
    <span class="nt">&quot;parent_shutdown_time&quot;</span><span class="p">:</span> <span class="s2">&quot;900s&quot;</span><span class="p">,</span>
    <span class="nt">&quot;cpuset_threads&quot;</span><span class="p">:</span> <span class="kc">false</span>
  <span class="p">},</span>
  <span class="nt">&quot;uptime_current_epoch&quot;</span><span class="p">:</span> <span class="s2">&quot;6s&quot;</span><span class="p">,</span>
  <span class="nt">&quot;uptime_all_epochs&quot;</span><span class="p">:</span> <span class="s2">&quot;6s&quot;</span><span class="p">,</span>
  <span class="nt">&quot;node&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;node1&quot;</span><span class="p">,</span>
    <span class="nt">&quot;cluster&quot;</span><span class="p">:</span> <span class="s2">&quot;cluster1&quot;</span><span class="p">,</span>
    <span class="nt">&quot;user_agent_name&quot;</span><span class="p">:</span> <span class="s2">&quot;envoy&quot;</span><span class="p">,</span>
    <span class="nt">&quot;user_agent_build_version&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&quot;version&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;major_number&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="nt">&quot;minor_number&quot;</span><span class="p">:</span> <span class="mi">15</span><span class="p">,</span>
        <span class="nt">&quot;patch&quot;</span><span class="p">:</span> <span class="mi">0</span>
      <span class="p">}</span>
    <span class="p">},</span>
    <span class="nt">&quot;metadata&quot;</span><span class="p">:</span> <span class="p">{},</span>
    <span class="nt">&quot;extensions&quot;</span><span class="p">:</span> <span class="p">[],</span>
    <span class="nt">&quot;client_features&quot;</span><span class="p">:</span> <span class="p">[],</span>
    <span class="nt">&quot;listening_addresses&quot;</span><span class="p">:</span> <span class="p">[]</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>见 <a class="reference internal" href="../api-v3/admin/v3/server_info.proto.html#envoy-v3-api-msg-admin-v3-serverinfo"><span class="std std-ref">ServerInfo 原型</span></a> 中对输出的解释。</p>
</dd></dl>

<dl class="http get">
<dt id="get--ready">
<code class="sig-name descname">GET </code><code class="sig-name descname">/ready</code><a class="headerlink" href="#get--ready" title="Permalink to this definition">¶</a></dt>
<dd><p>输出反映服务器状态的字符串和错误代码。LIVE 状态返回 200，否则为 503。这个可以用作就绪检查。</p>
<p>示例输出：</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>LIVE
</pre></div>
</div>
<p>查看 <a class="reference internal" href="../api-v3/admin/v3/server_info.proto.html#envoy-v3-api-msg-admin-v3-serverinfo"><span class="std std-ref">ServerInfo proto</span></a> 中 <cite>stat</cite> 字段的输出说明。</p>
</dd></dl>

<span class="target" id="operations-admin-interface-stats"></span><dl class="http get">
<dt id="get--stats">
<code class="sig-name descname">GET </code><code class="sig-name descname">/stats</code><a class="headerlink" href="#get--stats" title="Permalink to this definition">¶</a></dt>
<dd><p>根据需要输出所有统计信息。此命令对本地调试非常有用。直方图将输出计算的分位数，即 P0、P25、P50、P75、P90、P99、P99.9 和 P100.
每个分位数的输出将采用（间隔，累计值）的形式，其中间隔值代表自上次刷新间隔依赖的摘要，累计值代表自 Envoy 实例启动依赖的摘要。
直方图输出中的“未记录的值”标识尚未使用值进行更新。
有关更多信息，见 <a class="reference internal" href="stats_overview.html#operations-stats"><span class="std std-ref">这里</span></a>。</p>
<dl class="http get">
<dt id="get--stats?usedonly">
<code class="sig-name descname">GET </code><code class="sig-name descname">/stats?usedonly</code><a class="headerlink" href="#get--stats?usedonly" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>输出 Envoy 已更新的统计信息（计数器至少增加一次、计量器至少改变一次、直方图至少增加一次）。</p>
<dl class="http get">
<dt id="get--stats?filter=regex">
<code class="sig-name descname">GET </code><code class="sig-name descname">/stats?filter=regex</code><a class="headerlink" href="#get--stats?filter=regex" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>将返回的统计信息过滤为名称与正则表达式 <cite>regex</cite> 匹配的统计信息。与 <cite>usedonly</cite> 兼容。
默认情况下执行部分匹配，因此 <cite>/stats?filter=server</cite> 将返回所有包含单词 <cite>server</cite> 的统计信息。
可以使用开始和结束行锚指定全字符串匹配。（例如 <cite>/stats?filter=server</cite>）</p>
</dd></dl>

<dl class="http get">
<dt id="get--stats?format=json">
<code class="sig-name descname">GET </code><code class="sig-name descname">/stats?format=json</code><a class="headerlink" href="#get--stats?format=json" title="Permalink to this definition">¶</a></dt>
<dd><p>以 JSON 格式输出 /stats。这可以用于以编程的方式访问统计信息。计数器和计量器将采用一组（名称，值）对的形式。
直方图将在元素“histograms”下，该元素包含“supported_quantiles”（列出支持的分位数）
和一个 computed_quantiles 数组，该数组具有每个直方图的已计算分位数。</p>
<p>如果在间隔内直方图未更新，则所有分位数的输出都将为空。</p>
<p>实例直方图输出如下：</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;histograms&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;supported_quantiles&quot;</span><span class="p">:</span> <span class="p">[</span>
      <span class="mi">0</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">75</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">95</span><span class="p">,</span> <span class="mi">99</span><span class="p">,</span> <span class="mf">99.9</span><span class="p">,</span> <span class="mi">100</span>
    <span class="p">],</span>
    <span class="nt">&quot;computed_quantiles&quot;</span><span class="p">:</span> <span class="p">[</span>
      <span class="p">{</span>
        <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;cluster.external_auth_cluster.upstream_cx_length_ms&quot;</span><span class="p">,</span>
        <span class="nt">&quot;values&quot;</span><span class="p">:</span> <span class="p">[</span>
          <span class="p">{</span><span class="nt">&quot;interval&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="nt">&quot;cumulative&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span>
          <span class="p">{</span><span class="nt">&quot;interval&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="nt">&quot;cumulative&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span>
          <span class="p">{</span><span class="nt">&quot;interval&quot;</span><span class="p">:</span> <span class="mf">1.0435787</span><span class="p">,</span> <span class="nt">&quot;cumulative&quot;</span><span class="p">:</span> <span class="mf">1.0435787</span><span class="p">},</span>
          <span class="p">{</span><span class="nt">&quot;interval&quot;</span><span class="p">:</span> <span class="mf">1.0941565</span><span class="p">,</span> <span class="nt">&quot;cumulative&quot;</span><span class="p">:</span> <span class="mf">1.0941565</span><span class="p">},</span>
          <span class="p">{</span><span class="nt">&quot;interval&quot;</span><span class="p">:</span> <span class="mf">2.0860023</span><span class="p">,</span> <span class="nt">&quot;cumulative&quot;</span><span class="p">:</span> <span class="mf">2.0860023</span><span class="p">},</span>
          <span class="p">{</span><span class="nt">&quot;interval&quot;</span><span class="p">:</span> <span class="mf">3.0665233</span><span class="p">,</span> <span class="nt">&quot;cumulative&quot;</span><span class="p">:</span> <span class="mf">3.0665233</span><span class="p">},</span>
          <span class="p">{</span><span class="nt">&quot;interval&quot;</span><span class="p">:</span> <span class="mf">6.046609</span><span class="p">,</span> <span class="nt">&quot;cumulative&quot;</span><span class="p">:</span> <span class="mf">6.046609</span><span class="p">},</span>
          <span class="p">{</span><span class="nt">&quot;interval&quot;</span><span class="p">:</span> <span class="mf">229.57333</span><span class="p">,</span><span class="nt">&quot;cumulative&quot;</span><span class="p">:</span> <span class="mf">229.57333</span><span class="p">},</span>
          <span class="p">{</span><span class="nt">&quot;interval&quot;</span><span class="p">:</span> <span class="mi">260</span><span class="p">,</span><span class="nt">&quot;cumulative&quot;</span><span class="p">:</span> <span class="mi">260</span><span class="p">}</span>
        <span class="p">]</span>
      <span class="p">},</span>
      <span class="p">{</span>
        <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;http.admin.downstream_rq_time&quot;</span><span class="p">,</span>
        <span class="nt">&quot;values&quot;</span><span class="p">:</span> <span class="p">[</span>
          <span class="p">{</span><span class="nt">&quot;interval&quot;</span><span class="p">:</span> <span class="kc">null</span><span class="p">,</span> <span class="nt">&quot;cumulative&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span>
          <span class="p">{</span><span class="nt">&quot;interval&quot;</span><span class="p">:</span> <span class="kc">null</span><span class="p">,</span> <span class="nt">&quot;cumulative&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span>
          <span class="p">{</span><span class="nt">&quot;interval&quot;</span><span class="p">:</span> <span class="kc">null</span><span class="p">,</span> <span class="nt">&quot;cumulative&quot;</span><span class="p">:</span> <span class="mf">1.0435787</span><span class="p">},</span>
          <span class="p">{</span><span class="nt">&quot;interval&quot;</span><span class="p">:</span> <span class="kc">null</span><span class="p">,</span> <span class="nt">&quot;cumulative&quot;</span><span class="p">:</span> <span class="mf">1.0941565</span><span class="p">},</span>
          <span class="p">{</span><span class="nt">&quot;interval&quot;</span><span class="p">:</span> <span class="kc">null</span><span class="p">,</span> <span class="nt">&quot;cumulative&quot;</span><span class="p">:</span> <span class="mf">2.0860023</span><span class="p">},</span>
          <span class="p">{</span><span class="nt">&quot;interval&quot;</span><span class="p">:</span> <span class="kc">null</span><span class="p">,</span> <span class="nt">&quot;cumulative&quot;</span><span class="p">:</span> <span class="mf">3.0665233</span><span class="p">},</span>
          <span class="p">{</span><span class="nt">&quot;interval&quot;</span><span class="p">:</span> <span class="kc">null</span><span class="p">,</span> <span class="nt">&quot;cumulative&quot;</span><span class="p">:</span> <span class="mf">6.046609</span><span class="p">},</span>
          <span class="p">{</span><span class="nt">&quot;interval&quot;</span><span class="p">:</span> <span class="kc">null</span><span class="p">,</span> <span class="nt">&quot;cumulative&quot;</span><span class="p">:</span> <span class="mf">229.57333</span><span class="p">},</span>
          <span class="p">{</span><span class="nt">&quot;interval&quot;</span><span class="p">:</span> <span class="kc">null</span><span class="p">,</span> <span class="nt">&quot;cumulative&quot;</span><span class="p">:</span> <span class="mi">260</span><span class="p">}</span>
        <span class="p">]</span>
      <span class="p">}</span>
    <span class="p">]</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<dl class="http get">
<dt id="get--stats?format=json&amp;usedonly">
<code class="sig-name descname">GET </code><code class="sig-name descname">/stats?format=json&amp;usedonly</code><a class="headerlink" href="#get--stats?format=json&usedonly" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>以 JSON 格式输出 Envoy 已更新的统计信息（计数器至少增加一次、计量器至少改变一次、直方图至少增加一次）。</p>
</dd></dl>

<dl class="http get">
<dt id="get--stats?format=prometheus">
<code class="sig-name descname">GET </code><code class="sig-name descname">/stats?format=prometheus</code><a class="headerlink" href="#get--stats?format=prometheus" title="Permalink to this definition">¶</a></dt>
<dd><p>或者，</p>
<dl class="http get">
<dt id="get--stats-prometheus">
<code class="sig-name descname">GET </code><code class="sig-name descname">/stats/prometheus</code><a class="headerlink" href="#get--stats-prometheus" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>以 <a class="reference external" href="https://prometheus.io/docs/instrumenting/exposition_formats/">Prometheus</a> v0.0.4 格式输出 /stats。
这可以用来与 Prometheus 服务器集成。</p>
<p>可以选择传递 <cite>usedonly</cite> URL 查询参数，来仅获取 Envoy 已更新的统计信息（计数器至少增加一次、计量器至少改变一次、直方图至少增加一次）。</p>
<dl class="http get">
<dt id="get--stats-recentlookups">
<code class="sig-name descname">GET </code><code class="sig-name descname">/stats/recentlookups</code><a class="headerlink" href="#get--stats-recentlookups" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>此端点可以帮助 Envoy 开发人员调试统计系统中潜在的争用问题。最初，仅累加 StatName 查找的计数，
而不累加正在查到的特定名称。为了查看特定的近期请求，必须通过 POST 到 <cite>/stats/recentlookups/enable</cite>
来启用该功能。每次查找可能会增加大约 40-100 纳秒的开销。</p>
<p>启用后，此端点将发出最近被 Envoy 以字符串形式访问的指标名。理想情况下，仅在启动过程中或通过 xDS 接收新配置时，
才应将字符串转换为 StatName、计数器、计量器和直方图。这是因为当将统计信息作为字符串查找时，它们必须讲全局符号表锁定。
在启动过程中这是可以接受的，但是在高核心数计算机上响应的用户请求，由于互斥锁争用，这可能会导致性能问题。</p>
<p>该管理端点需要 Envoy 使用 <cite>–use-fake-symbol-table 0</cite> 选项启动。</p>
<p>更多详细信息见 <a class="reference external" href="https://github.com/envoyproxy/envoy/blob/ab2dbfce2ad07988f64a7ecf18e820e27078c00b/source/docs/stats.md">source/docs/stats.md</a>。</p>
<p>同样要注意互斥征用可以通过 <a class="reference internal" href="#get--contention" title="GET /contention"><code class="xref http http-get docutils literal notranslate"><span class="pre">GET</span> <span class="pre">/contention</span></code></a> 进行追踪。</p>
<dl class="http post">
<dt id="post--stats-recentlookups-enable">
<code class="sig-name descname">POST </code><code class="sig-name descname">/stats/recentlookups/enable</code><a class="headerlink" href="#post--stats-recentlookups-enable" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>通过开启 <cite>/stats/recentlookups</cite>，来打开对最近查找的统计名称的收集。</p>
<p>更多详细信息见 <a class="reference external" href="https://github.com/envoyproxy/envoy/blob/ab2dbfce2ad07988f64a7ecf18e820e27078c00b/source/docs/stats.md">source/docs/stats.md</a>。</p>
<dl class="http post">
<dt id="post--stats-recentlookups-disable">
<code class="sig-name descname">POST </code><code class="sig-name descname">/stats/recentlookups/disable</code><a class="headerlink" href="#post--stats-recentlookups-disable" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>禁用 <cite>/stats/recentlookups</cite> 可关闭对最近查找的统计名称的收集。同时清空查找列表。
但是统计信息中 <cite>server.stats_recent_lookups</cite> 的计数仍可见，不会被清空且继续累积。</p>
<p>更多详细信息见 <a class="reference external" href="https://github.com/envoyproxy/envoy/blob/ab2dbfce2ad07988f64a7ecf18e820e27078c00b/source/docs/stats.md">source/docs/stats.md</a>。</p>
<dl class="http post">
<dt id="post--stats-recentlookups-clear">
<code class="sig-name descname">POST </code><code class="sig-name descname">/stats/recentlookups/clear</code><a class="headerlink" href="#post--stats-recentlookups-clear" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>清除所有未完成的查找和计数。同样会清空查找数据以及计数，但是如果启用之后会继续收集。</p>
<p>更多详细信息见 <a class="reference external" href="https://github.com/envoyproxy/envoy/blob/ab2dbfce2ad07988f64a7ecf18e820e27078c00b/source/docs/stats.md">source/docs/stats.md</a>。</p>
</dd></dl>

<span class="target" id="operations-admin-interface-runtime"></span><dl class="http get">
<dt id="get--runtime">
<code class="sig-name descname">GET </code><code class="sig-name descname">/runtime</code><a class="headerlink" href="#get--runtime" title="Permalink to this definition">¶</a></dt>
<dd><p>根据需要以 JSON 格式输出所有运行时值。有关如何配置和利用这些值的更多信息，见 <a class="reference internal" href="../intro/arch_overview/operations/runtime.html#arch-overview-runtime"><span class="std std-ref">此处</span></a>。
输出包括活跃运行时覆盖层的列表以及每个键的层值堆栈。空字符串表示没有值，并且堆栈中的最终活动值也包含在单独的键中。
输出示例：</p>
</dd></dl>

<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;layers&quot;</span><span class="p">:</span> <span class="p">[</span>
    <span class="s2">&quot;disk&quot;</span><span class="p">,</span>
    <span class="s2">&quot;override&quot;</span><span class="p">,</span>
    <span class="s2">&quot;admin&quot;</span><span class="p">,</span>
  <span class="p">],</span>
  <span class="nt">&quot;entries&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;my_key&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&quot;layer_values&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="s2">&quot;my_disk_value&quot;</span><span class="p">,</span>
        <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="s2">&quot;&quot;</span>
      <span class="p">],</span>
      <span class="nt">&quot;final_value&quot;</span><span class="p">:</span> <span class="s2">&quot;my_disk_value&quot;</span>
    <span class="p">},</span>
    <span class="nt">&quot;my_second_key&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&quot;layer_values&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="s2">&quot;my_second_disk_value&quot;</span><span class="p">,</span>
        <span class="s2">&quot;my_disk_override_value&quot;</span><span class="p">,</span>
        <span class="s2">&quot;my_admin_override_value&quot;</span>
      <span class="p">],</span>
      <span class="nt">&quot;final_value&quot;</span><span class="p">:</span> <span class="s2">&quot;my_admin_override_value&quot;</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<span class="target" id="operations-admin-interface-runtime-modify"></span><dl class="http post">
<dt id="post--runtime_modify?key1=value1&amp;key2=value2&amp;keyN=valueN">
<code class="sig-name descname">POST </code><code class="sig-name descname">/runtime_modify?key1=value1&amp;key2=value2&amp;keyN=valueN</code><a class="headerlink" href="#post--runtime_modify?key1=value1&key2=value2&keyN=valueN" title="Permalink to this definition">¶</a></dt>
<dd><p>添加或修改在查询参数中传递的运行时值。要删除先前添加的键，请使用一个空字符串作为值。请注意，删除仅适用于通过此端点添加的替代；
从磁盘加载的值可以通过覆盖进行修改，但不能删除。</p>
</dd></dl>

<div class="admonition attention">
<p class="admonition-title">Attention</p>
<p>使用 /runtime_modify 端点时要小心。变更会立即生效。
<strong>至关重要的是</strong>，管理接口必须是被 <a class="reference internal" href="#operations-admin-interface-security"><span class="std std-ref">正确保护的</span></a>。</p>
<span class="target" id="operations-admin-interface-hystrix-event-stream"></span></div>
<dl class="http get">
<dt id="get--hystrix_event_stream">
<code class="sig-name descname">GET </code><code class="sig-name descname">/hystrix_event_stream</code><a class="headerlink" href="#get--hystrix_event_stream" title="Permalink to this definition">¶</a></dt>
<dd><p>该端点旨在用作 <a class="reference external" href="https://github.com/Netflix-Skunkworks/hystrix-dashboard/wiki">Hystrix 仪表盘</a> 的流源。
到此端点的 GET 请求会触发来自 Envoy <a class="reference external" href="https://developer.mozilla.org/en-US/docs/Web/API/Server-sent_events/Using_server-sent_events">text/event-stream</a> 格式的统计数据流，如 Hystrix 仪表板所期望的那样。</p>
<p>如果从浏览器或终端调用，则响应将显示为连续流，并按由 <a class="reference internal" href="../api-v3/config/bootstrap/v3/bootstrap.proto.html#envoy-v3-api-msg-config-bootstrap-v3-bootstrap"><span class="std std-ref">Bootstrap</span></a> 的 <a class="reference internal" href="../api-v3/config/bootstrap/v3/bootstrap.proto.html#envoy-v3-api-field-config-bootstrap-v3-bootstrap-stats-flush-interval"><span class="std std-ref">stats_flush_interval</span></a> 定义的间隔发送。</p>
<p>仅当在配置文件中启用 Hystrix 接收器时，才启用此处理器，如 <a class="reference internal" href="../api-v3/config/metrics/v3/stats.proto.html#envoy-v3-api-msg-config-metrics-v3-hystrixsink"><span class="std std-ref">这里</span></a> 记录的那样。</p>
<p>由于 Envoy 和 Hystrix 的弹性机制不同，因此必须调整仪表板中显示的某些统计信息：</p>
<ul class="simple">
<li><p><strong>线程池拒绝</strong> - 通常类似于 Envoy 中的断路，并由 <em>upstream_rq_pending_overflow</em> 进行计数，
尽管术语线程池不适用于 Envoy。在 Hystrix 和 Envoy 中，结果都是被拒绝的请求没有传递到上游。</p></li>
<li><p>** 断路器状态（闭合或断开）** - 由于在 Envoy 中，基于队列中当前连接/请求的数量断开了电路，因此断路器没有睡眠窗口，
因此断开/闭合是瞬时的。因此，我们将断路器状态设置为“强制闭合”。</p></li>
<li><p>** 短接（拒绝）** - 该属于存在于 Envoy 中，但指的是由于超出限制（队列或者连接）而未返送的请求，而在 Hystrix 中，
指的是在某个时间范围内，由于服务不可用响应的百分比很高而未发送的请求。在 Envoy 中，服务不可用响应将导致“异常检测” -
从负载均衡器池中移除该节点，但最终不会拒绝请求。因此，这个计数器始终设置为 ‘0’。</p></li>
<li><p>延迟信息表示自上次刷新以来的数据。
平均延迟目前不可用。</p></li>
</ul>
</dd></dl>

<dl class="http post">
<dt id="post--tap">
<code class="sig-name descname">POST </code><code class="sig-name descname">/tap</code><a class="headerlink" href="#post--tap" title="Permalink to this definition">¶</a></dt>
<dd><p>该端点用于配置活动的 tap 会话。仅当配置了有效的 tap 扩展并改扩展配置为接受管理员配置时，此功能才启用。见：</p>
<ul class="simple">
<li><p><a class="reference internal" href="../configuration/http/http_filters/tap_filter.html#config-http-filters-tap-admin-handler"><span class="std std-ref">HTTP tap 过滤器配置</span></a></p></li>
</ul>
</dd></dl>

<dl class="http post">
<dt id="post--reopen_logs">
<code class="sig-name descname">POST </code><code class="sig-name descname">/reopen_logs</code><a class="headerlink" href="#post--reopen_logs" title="Permalink to this definition">¶</a></dt>
<dd><p>触发重新打开所有访问日志。行为类似 SIGUSR1 的处理。</p>
</dd></dl>

</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="stats_overview.html" class="btn btn-neutral float-right" title="统计概览" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="hot_restarter.html" class="btn btn-neutral float-left" title="热重启 Python 封装器" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2016-2021, Envoy Project Authors

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>